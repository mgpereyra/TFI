@model IEnumerable<Proyecto.Database.Service>

@{
    ViewBag.Title = "Rutas";
}


<div class="d-flex mb-4">
    <div class="pb-lg-2 w-100">
        <h2><i class="fa fa-hands-helping pt-2 mr-2" aria-hidden="true"></i>Rutas</h2>
    </div>
    <div class="flex-shrink-1"> <a class="btn btn-primary m-2" href="Create"><i class="fa fa-plus-circle"></i>Crear
            nuevo</a></div>
</div>

<div class="row">

    <div class="col-sm-5">
        <div class="card text-white bg-dark">
            <div class="card-body" id="map_canvas">






            </div>
        </div>
    </div>

    <div class="col-sm-7">
        <div class="card text-white bg-dark">
            <div class="card-body">
                <table class="table table-striped table-dark table-responsive">
                    <thead class="font-weight-bold text-uppercase">
                        <tr class="border-bottom border-primary">
                            <td>Dirección</td>
                            <td>Latitud</td>
                            <td>Longitud</td>


                            <td>Estado</td>
                        <tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td>@item.Address</td>
                                <td>@item.Latitud</td>
                                <td>@item.Longitud</td>
                                <td>ch</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>





@section Scripts {
@Scripts.Render("~/bundles/jquery")
}



<style>
    #map_canvas {
        height: 400px;
    }
</style>

<script 
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD63Ptld6R6m6o8p3HkX9an3ksAw_faFBs">
    </script>

<script>
    var marcadores = @Html.Raw(Json.Encode(Model));
    console.log(marcadores);

    let map;
    let marker;
    let infowindow; 
    let position;
    let bounds = new google.maps.LatLngBounds();
    var infoWindow = new google.maps.InfoWindow();
    
    map = new google.maps.Map(document.getElementById("map_canvas"), {
        center: { lat:-34.6705129, lng: -58.5628652}, 
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        zoom: 14,
    });

    // Add multiple markers to map

    function initMarkers() {

        for (var i = 0; i < marcadores.length; i++) {
            // init markers
            position = new google.maps.LatLng(marcadores[i].Latitud, marcadores[i].Longitud);

            marker = new google.maps.Marker({
                position: position,
                map: map,
                title: marcadores[i].Address,
                number: i
            });
           // Add info window to marker    
            google.maps.event.addListener(marker, 'click', (function(marker, i) {
                return function() {
                infoWindow.setContent(
                    '<div>'+
                        '<p class="color-third my-1">'+ marker.title +'</p>'+
                     '</div>' );
                infoWindow.open(map, marker);
            }
            })(marker, i));

           // markers(marker);
            marker.setMap(map);
            bounds.extend(position);
           
        }
    map.fitBounds(bounds);

    }

    initMarkers();

</script>
